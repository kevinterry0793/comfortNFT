{"ast":null,"code":"import _regeneratorRuntime from\"/Users/hienle/Documents/GitHub/comfortNFT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectWithoutProperties from\"/Users/hienle/Documents/GitHub/comfortNFT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _asyncToGenerator from\"/Users/hienle/Documents/GitHub/comfortNFT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/hienle/Documents/GitHub/comfortNFT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/hienle/Documents/GitHub/comfortNFT/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import BigNumber from'bignumber.js/bignumber';import Web3 from'web3';import*as Types from\"./types.js\";import{SUBTRACT_GAS_LIMIT,addressMap}from'./constants.js';import ERC20Json from'../clean_build/contracts/IERC20.json';import YAMv2Json from'../clean_build/contracts/YAMv2.json';import YAMv2MigrationJson from'../clean_build/contracts/YAMv2Migration.json';import YAMJson from'../clean_build/contracts/YAMDelegator.json';import YAMRebaserJson from'../clean_build/contracts/YAMRebaser.json';import YAMReservesJson from'../clean_build/contracts/YAMReserves.json';import YAMGovJson from'../clean_build/contracts/GovernorAlpha.json';import YAMTimelockJson from'../clean_build/contracts/Timelock.json';import WETHJson from'./weth.json';import SNXJson from'./snx.json';import UNIFactJson from'./unifact2.json';import UNIPairJson from'./uni2.json';import UNIRouterJson from'./uniR.json';import WETHPoolJson from'../clean_build/contracts/YAMETHPool.json';import AMPLPoolJson from'../clean_build/contracts/YAMAMPLPool.json';import YFIPoolJson from'../clean_build/contracts/YAMYFIPool.json';import MKRPoolJson from'../clean_build/contracts/YAMMKRPool.json';import LENDPoolJson from'../clean_build/contracts/YAMLENDPool.json';import COMPPoolJson from'../clean_build/contracts/YAMCOMPPool.json';import SNXPoolJson from'../clean_build/contracts/YAMSNXPool.json';import LINKPoolJson from'../clean_build/contracts/YAMLINKPool.json';import IncOldJson from'../clean_build/contracts/YAMIncentivizerOld.json';import IncJson from'../clean_build/contracts/YAMIncentivizer.json';import StrnEthIncJson from'../clean_build/contracts/STRNIncentivizer.json';import StrnXiotIncJson from'../clean_build/contracts/STRNXIOTIncentivizer.json';import StxpIncentivizer from'../clean_build/contracts/STXPIncentivizer.json';import StrainNFT from'../clean_build/contracts/StrainNFT.json';import StrainNFTCrafter from'../clean_build/contracts/StrainNFTCrafter.json';import StrainNFTCrafterOLD from'../clean_build/contracts/StrainNFTCrafter.json';// same contract ABI different address hardcoded change below\nimport StrainNFTGenetics from'../clean_build/contracts/StrainNFTGenetics.json';import MigratorJson from\"../clean_build/contracts/Migrator.json\";import YAMv3Json from\"../clean_build/contracts/YAMDelegatorV3.json\";export var Contracts=/*#__PURE__*/function(){function Contracts(provider,networkId,web3,options){_classCallCheck(this,Contracts);this.web3=web3;this.defaultConfirmations=options.defaultConfirmations;this.autoGasMultiplier=options.autoGasMultiplier||1.5;this.confirmationType=options.confirmationType||Types.ConfirmationType.Confirmed;this.defaultGas=options.defaultGas;this.defaultGasPrice=options.defaultGasPrice;this.uni_pair=new this.web3.eth.Contract(UNIPairJson);this.uni_router=new this.web3.eth.Contract(UNIRouterJson);this.uni_fact=new this.web3.eth.Contract(UNIFactJson);this.yfi=new this.web3.eth.Contract(ERC20Json.abi);this.UNIAmpl=new this.web3.eth.Contract(ERC20Json.abi);this.ycrv=new this.web3.eth.Contract(ERC20Json.abi);this.yycrv=new this.web3.eth.Contract(ERC20Json.abi);this.yam=new this.web3.eth.Contract(YAMJson.abi);this.yfi_pool=new this.web3.eth.Contract(YFIPoolJson.abi);this.eth_pool=new this.web3.eth.Contract(WETHPoolJson.abi);this.ampl_pool=new this.web3.eth.Contract(AMPLPoolJson.abi);this.ycrv_pool=new this.web3.eth.Contract(IncOldJson.abi);this.yycrv_pool=new this.web3.eth.Contract(IncJson.abi);// new STRN incentivizer\nthis.strneth_pool=new this.web3.eth.Contract(StrnEthIncJson.abi);this.strnxiot_pool=new this.web3.eth.Contract(StrnXiotIncJson.abi);this.stxpInc_pool=new this.web3.eth.Contract(StxpIncentivizer.abi);// NFT \nthis.strain_nft=new this.web3.eth.Contract(StrainNFT.abi);this.strain_nft_crafter=new this.web3.eth.Contract(StrainNFTCrafter.abi);// j00lz hack for burn nfts page\nStrainNFTCrafterOLD.networks[1].address=\"0xCbb9fA9b7b3d70231B4aD1C6819D6251d612b116\";this.strain_nft_crafter_old=new this.web3.eth.Contract(StrainNFTCrafterOLD.abi);this.strain_nft_genetics=new this.web3.eth.Contract(StrainNFTGenetics.abi);this.comp_pool=new this.web3.eth.Contract(COMPPoolJson.abi);this.link_pool=new this.web3.eth.Contract(LINKPoolJson.abi);this.lend_pool=new this.web3.eth.Contract(LENDPoolJson.abi);this.snx_pool=new this.web3.eth.Contract(SNXPoolJson.abi);this.mkr_pool=new this.web3.eth.Contract(MKRPoolJson.abi);this.comp=new this.web3.eth.Contract(ERC20Json.abi);this.link=new this.web3.eth.Contract(ERC20Json.abi);this.lend=new this.web3.eth.Contract(ERC20Json.abi);this.snx=new this.web3.eth.Contract(ERC20Json.abi);this.mkr=new this.web3.eth.Contract(ERC20Json.abi);this.yam_ycrv_uni_lp=new this.web3.eth.Contract(ERC20Json.abi);this.yam_yycrv_uni_lp=new this.web3.eth.Contract(ERC20Json.abi);this.erc20=new this.web3.eth.Contract(ERC20Json.abi);this.pool=new this.web3.eth.Contract(LENDPoolJson.abi);this.yamV2=new this.web3.eth.Contract(YAMv2Json.abi);this.yamV2migration=new this.web3.eth.Contract(YAMv2MigrationJson.abi);this.yamV3=new this.web3.eth.Contract(YAMv3Json.abi);this.migrator=new this.web3.eth.Contract(MigratorJson.abi);this.rebaser=new this.web3.eth.Contract(YAMRebaserJson.abi);this.reserves=new this.web3.eth.Contract(YAMReservesJson.abi);this.gov=new this.web3.eth.Contract(YAMGovJson.abi);this.gov2=new this.web3.eth.Contract(YAMGovJson.abi);this.timelock=new this.web3.eth.Contract(YAMTimelockJson.abi);this.weth=new this.web3.eth.Contract(WETHJson);this.setProvider(provider,networkId);this.setDefaultAccount(this.web3.eth.defaultAccount);}_createClass(Contracts,[{key:\"setProvider\",value:function setProvider(provider,networkId){var _this=this;this.yam.setProvider(provider);this.rebaser.setProvider(provider);this.reserves.setProvider(provider);this.gov.setProvider(provider);this.timelock.setProvider(provider);var contracts=[{contract:this.yam,json:YAMJson},{contract:this.rebaser,json:YAMRebaserJson},{contract:this.reserves,json:YAMReservesJson},{contract:this.gov,json:YAMGovJson},{contract:this.timelock,json:YAMTimelockJson},{contract:this.ycrv_pool,json:IncOldJson},{contract:this.yycrv_pool,json:IncJson},{contract:this.strneth_pool,json:StrnEthIncJson},{contract:this.strain_nft,json:StrainNFT},{contract:this.strain_nft_crafter,json:StrainNFTCrafter},{contract:this.strain_nft_crafter_old,json:StrainNFTCrafterOLD},{contract:this.strain_nft_genetics,json:StrainNFTGenetics},{contract:this.strnxiot_pool,json:StrnXiotIncJson},{contract:this.stxpInc_pool,json:StxpIncentivizer},{contract:this.eth_pool,json:WETHPoolJson},{contract:this.yfi_pool,json:YFIPoolJson},{contract:this.ampl_pool,json:AMPLPoolJson},{contract:this.snx_pool,json:SNXPoolJson},{contract:this.mkr_pool,json:MKRPoolJson},{contract:this.lend_pool,json:LENDPoolJson},{contract:this.link_pool,json:LINKPoolJson},{contract:this.comp_pool,json:COMPPoolJson},{contract:this.yamV2,json:YAMv2Json},{contract:this.yamV2migration,json:YAMv2MigrationJson},{contract:this.yamV3,json:YAMv3Json},{contract:this.migrator,json:MigratorJson}];contracts.forEach(function(contract){return _this.setContractProvider(contract.contract,contract.json,provider,networkId);});this.yfi.options.address=addressMap[\"YFI\"];this.ycrv.options.address=addressMap[\"YCRV\"];this.yycrv.options.address=addressMap[\"YYCRV\"];this.weth.options.address=addressMap[\"WETH\"];this.snx.options.address=addressMap[\"SNX\"];this.comp.options.address=addressMap[\"COMP\"];this.link.options.address=addressMap[\"LINK\"];this.lend.options.address=addressMap[\"LEND\"];this.mkr.options.address=addressMap[\"MKR\"];this.UNIAmpl.options.address=addressMap[\"UNIAmpl\"];this.uni_fact.options.address=addressMap[\"uniswapFactoryV2\"];this.uni_router.options.address=addressMap[\"UNIRouter\"];this.yam_ycrv_uni_lp.options.address=addressMap[\"YAMYCRV\"];this.yam_yycrv_uni_lp.options.address=addressMap[\"YAMYYCRV\"];this.gov2.options.address=\"0x78BdD33e95ECbcAC16745FB28DB0FFb703344026\";this.pools=[{\"tokenAddr\":this.yfi.options.address,\"poolAddr\":this.yfi_pool.options.address},{\"tokenAddr\":this.snx.options.address,\"poolAddr\":this.snx_pool.options.address},{\"tokenAddr\":this.weth.options.address,\"poolAddr\":this.eth_pool.options.address},{\"tokenAddr\":this.comp.options.address,\"poolAddr\":this.comp_pool.options.address},{\"tokenAddr\":this.link.options.address,\"poolAddr\":this.link_pool.options.address},{\"tokenAddr\":this.lend.options.address,\"poolAddr\":this.lend_pool.options.address},{\"tokenAddr\":this.mkr.options.address,\"poolAddr\":this.mkr_pool.options.address},{\"tokenAddr\":this.UNIAmpl.options.address,\"poolAddr\":this.ampl_pool.options.address}];this.names={};this.names[this.yam.options.address]=\"YAMv1\";this.names[this.rebaser.options.address]=\"Rebaser\";this.names[this.reserves.options.address]=\"Reserves\";this.names[this.gov.options.address]=\"Previous Governor\";this.names[this.timelock.options.address]=\"Timelock Governance\";this.names[this.ycrv_pool.options.address]=\"YCRV Pool\";this.names[this.yycrv_pool.options.address]=\"yUSD Farming\";this.names[this.strneth_pool.options.address]=\"STRN Farming\";this.names[this.strnxiot_pool.options.address]=\"STRN Farming\";this.names[this.yamV2.options.address]=\"YAMv2\";this.names[this.yamV2migration.options.address]=\"YAMv1-YAMv2 Migrator\";this.names[this.yamV3.options.address]=\"YAM (v3)\";this.names[this.migrator.options.address]=\"Migrator\";this.names[this.gov2.options.address]=\"Current Governor\";}},{key:\"setDefaultAccount\",value:function setDefaultAccount(account){this.yfi.options.from=account;this.ycrv.options.from=account;this.yam.options.from=account;this.weth.options.from=account;}},{key:\"callContractFunction\",value:function(){var _callContractFunction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(method,options){var _this2=this;var confirmations,confirmationType,autoGasMultiplier,txOptions,gasEstimate,data,from,value,to,multiplier,totalGas,g,promi,OUTCOMES,hashOutcome,confirmationOutcome,t,hashPromise,confirmationPromise,_transactionHash,transactionHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:confirmations=options.confirmations,confirmationType=options.confirmationType,autoGasMultiplier=options.autoGasMultiplier,txOptions=_objectWithoutProperties(options,[\"confirmations\",\"confirmationType\",\"autoGasMultiplier\"]);if(this.blockGasLimit){_context.next=4;break;}_context.next=4;return this.setGasLimit();case 4:if(!txOptions.gasPrice&&this.defaultGasPrice){txOptions.gasPrice=this.defaultGasPrice;}if(!(confirmationType===Types.ConfirmationType.Simulate||!options.gas)){_context.next=30;break;}if(!(this.defaultGas&&confirmationType!==Types.ConfirmationType.Simulate)){_context.next=10;break;}txOptions.gas=this.defaultGas;_context.next=27;break;case 10:_context.prev=10;console.log(\"estimating gas\");_context.next=14;return method.estimateGas(txOptions);case 14:gasEstimate=_context.sent;_context.next=24;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](10);data=method.encodeABI();from=options.from,value=options.value;to=method._parent._address;_context.t0.transactionData={from:from,value:value,data:data,to:to};throw _context.t0;case 24:multiplier=autoGasMultiplier||this.autoGasMultiplier;totalGas=Math.floor(gasEstimate*multiplier);txOptions.gas=totalGas<this.blockGasLimit?totalGas:this.blockGasLimit;case 27:if(!(confirmationType===Types.ConfirmationType.Simulate)){_context.next=30;break;}g=txOptions.gas;return _context.abrupt(\"return\",{gasEstimate:gasEstimate,g:g});case 30:if(txOptions.value){txOptions.value=new BigNumber(txOptions.value).toFixed(0);}else{txOptions.value='0';}promi=method.send(txOptions);OUTCOMES={INITIAL:0,RESOLVED:1,REJECTED:2};hashOutcome=OUTCOMES.INITIAL;confirmationOutcome=OUTCOMES.INITIAL;t=confirmationType!==undefined?confirmationType:this.confirmationType;if(Object.values(Types.ConfirmationType).includes(t)){_context.next=38;break;}throw new Error(\"Invalid confirmation type: \".concat(t));case 38:if(t===Types.ConfirmationType.Hash||t===Types.ConfirmationType.Both){hashPromise=new Promise(function(resolve,reject){promi.on('error',function(error){if(hashOutcome===OUTCOMES.INITIAL){hashOutcome=OUTCOMES.REJECTED;reject(error);var anyPromi=promi;anyPromi.off();}});promi.on('transactionHash',function(txHash){if(hashOutcome===OUTCOMES.INITIAL){hashOutcome=OUTCOMES.RESOLVED;resolve(txHash);if(t!==Types.ConfirmationType.Both){var anyPromi=promi;anyPromi.off();}}});});}if(t===Types.ConfirmationType.Confirmed||t===Types.ConfirmationType.Both){confirmationPromise=new Promise(function(resolve,reject){promi.on('error',function(error){if((t===Types.ConfirmationType.Confirmed||hashOutcome===OUTCOMES.RESOLVED)&&confirmationOutcome===OUTCOMES.INITIAL){confirmationOutcome=OUTCOMES.REJECTED;reject(error);var anyPromi=promi;anyPromi.off();}});var desiredConf=confirmations||_this2.defaultConfirmations;if(desiredConf){promi.on('confirmation',function(confNumber,receipt){if(confNumber>=desiredConf){if(confirmationOutcome===OUTCOMES.INITIAL){confirmationOutcome=OUTCOMES.RESOLVED;resolve(receipt);var anyPromi=promi;anyPromi.off();}}});}else{promi.on('receipt',function(receipt){confirmationOutcome=OUTCOMES.RESOLVED;resolve(receipt);var anyPromi=promi;anyPromi.off();});}});}if(!(t===Types.ConfirmationType.Hash)){_context.next=46;break;}_context.next=43;return hashPromise;case 43:_transactionHash=_context.sent;if(this.notifier){this.notifier.hash(_transactionHash);}return _context.abrupt(\"return\",{transactionHash:_transactionHash});case 46:if(!(t===Types.ConfirmationType.Confirmed)){_context.next=48;break;}return _context.abrupt(\"return\",confirmationPromise);case 48:_context.next=50;return hashPromise;case 50:transactionHash=_context.sent;if(this.notifier){this.notifier.hash(transactionHash);}return _context.abrupt(\"return\",{transactionHash:transactionHash,confirmation:confirmationPromise});case 53:case\"end\":return _context.stop();}}},_callee,this,[[10,17]]);}));function callContractFunction(_x,_x2){return _callContractFunction.apply(this,arguments);}return callContractFunction;}()},{key:\"callConstantContractFunction\",value:function(){var _callConstantContractFunction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(method,options){var m2,blockNumber,txOptions;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:m2=method;blockNumber=options.blockNumber,txOptions=_objectWithoutProperties(options,[\"blockNumber\"]);return _context2.abrupt(\"return\",m2.call(txOptions,blockNumber));case 3:case\"end\":return _context2.stop();}}},_callee2);}));function callConstantContractFunction(_x3,_x4){return _callConstantContractFunction.apply(this,arguments);}return callConstantContractFunction;}()},{key:\"setGasLimit\",value:function(){var _setGasLimit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var block;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.web3.eth.getBlock('latest');case 2:block=_context3.sent;this.blockGasLimit=block.gasLimit-SUBTRACT_GAS_LIMIT;case 4:case\"end\":return _context3.stop();}}},_callee3,this);}));function setGasLimit(){return _setGasLimit.apply(this,arguments);}return setGasLimit;}()},{key:\"setContractProvider\",value:function setContractProvider(contract,contractJson,provider,networkId){contract.setProvider(provider);try{contract.options.address=contractJson.networks[networkId]&&contractJson.networks[networkId].address;}catch(error){// console.log(error)\n}}}]);return Contracts;}();","map":null,"metadata":{},"sourceType":"module"}