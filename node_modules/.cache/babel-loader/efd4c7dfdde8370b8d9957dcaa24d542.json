{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ethers_1 = require(\"ethers\");\n\nvar utils_1 = require(\"ethers/lib/utils\");\n\nvar enums_1 = require(\"./enums\");\n\nvar utils_2 = require(\"./utils\");\n\nvar Multicall =\n/** @class */\nfunction () {\n  function Multicall(_options) {\n    this._options = _options;\n    this.ABI = [{\n      constant: false,\n      inputs: [{\n        components: [{\n          name: 'target',\n          type: 'address'\n        }, {\n          name: 'callData',\n          type: 'bytes'\n        }],\n        name: 'calls',\n        type: 'tuple[]'\n      }],\n      name: 'aggregate',\n      outputs: [{\n        name: 'blockNumber',\n        type: 'uint256'\n      }, {\n        name: 'returnData',\n        type: 'bytes[]'\n      }],\n      payable: false,\n      stateMutability: 'nonpayable',\n      type: 'function'\n    }];\n\n    if (this._options.web3Instance) {\n      this._executionType = enums_1.ExecutionType.web3;\n      return;\n    }\n\n    if (this._options.ethersProvider) {\n      this._executionType = enums_1.ExecutionType.ethers;\n      return;\n    }\n\n    if (this._options.nodeUrl) {\n      this._executionType = enums_1.ExecutionType.customHttp;\n      return;\n    }\n\n    throw new Error( // tslint:disable-next-line: max-line-length\n    'Your options passed in our incorrect they need to match either `MulticallOptionsEthers`, `MulticallOptionsWeb3` or `MulticallOptionsCustomJsonRpcProvider` interfaces');\n  }\n  /**\r\n   * Call all the contract calls in 1\r\n   * @param calls The calls\r\n   */\n\n\n  Multicall.prototype.call = function (contractCallContexts) {\n    return __awaiter(this, void 0, void 0, function () {\n      var aggregateResponse, returnObject, response, contractCallsResults, originalContractCallContext, returnObjectResult, method, methodContext, originalContractCallMethodContext, outputTypes, decodedReturnValue;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!Array.isArray(contractCallContexts)) {\n              contractCallContexts = [contractCallContexts];\n            }\n\n            return [4\n            /*yield*/\n            , this.execute(this.buildAggregateCallContext(contractCallContexts))];\n\n          case 1:\n            aggregateResponse = _a.sent();\n            returnObject = {\n              results: {},\n              blockNumber: aggregateResponse.blockNumber\n            };\n\n            for (response = 0; response < aggregateResponse.results.length; response++) {\n              contractCallsResults = aggregateResponse.results[response];\n              originalContractCallContext = contractCallContexts[contractCallsResults.contractContextIndex];\n              returnObjectResult = {\n                originalContractCallContext: utils_2.Utils.deepClone(originalContractCallContext),\n                callsReturnContext: []\n              };\n\n              for (method = 0; method < contractCallsResults.methodResults.length; method++) {\n                methodContext = contractCallsResults.methodResults[method];\n                originalContractCallMethodContext = originalContractCallContext.calls[methodContext.contractMethodIndex];\n                outputTypes = this.findOutputTypesFromAbi(originalContractCallContext.abi, originalContractCallMethodContext.methodName);\n\n                if (outputTypes && outputTypes.length > 0) {\n                  decodedReturnValue = utils_1.defaultAbiCoder.decode( // tslint:disable-next-line: no-any\n                  outputTypes, methodContext.returnData);\n                  returnObjectResult.callsReturnContext.push(utils_2.Utils.deepClone({\n                    // ethers put the result of the decode in an array\n                    returnValues: decodedReturnValue[0],\n                    decoded: true,\n                    reference: originalContractCallMethodContext.reference,\n                    methodName: originalContractCallMethodContext.methodName,\n                    methodParameters: originalContractCallMethodContext.methodParameters\n                  }));\n                } else {\n                  returnObjectResult.callsReturnContext.push(utils_2.Utils.deepClone({\n                    returnValues: methodContext.returnData,\n                    decoded: false,\n                    reference: originalContractCallMethodContext.reference,\n                    methodName: originalContractCallMethodContext.methodName,\n                    methodParameters: originalContractCallMethodContext.methodParameters\n                  }));\n                }\n              }\n\n              returnObject.results[returnObjectResult.originalContractCallContext.reference] = returnObjectResult;\n            }\n\n            return [2\n            /*return*/\n            , returnObject];\n        }\n      });\n    });\n  };\n  /**\r\n   * Build aggregate call context\r\n   * @param contractCallContexts The contract call contexts\r\n   */\n\n\n  Multicall.prototype.buildAggregateCallContext = function (contractCallContexts) {\n    var aggregateCallContext = [];\n\n    for (var contract = 0; contract < contractCallContexts.length; contract++) {\n      var contractContext = contractCallContexts[contract];\n      var executingInterface = new ethers_1.ethers.utils.Interface(JSON.stringify(contractContext.abi));\n\n      for (var method = 0; method < contractContext.calls.length; method++) {\n        // https://github.com/ethers-io/ethers.js/issues/211\n        var methodContext = contractContext.calls[method]; // tslint:disable-next-line: no-unused-expression\n\n        var encodedData = executingInterface.encodeFunctionData(methodContext.methodName, methodContext.methodParameters);\n        aggregateCallContext.push({\n          contractContextIndex: utils_2.Utils.deepClone(contract),\n          contractMethodIndex: utils_2.Utils.deepClone(method),\n          target: contractContext.contractAddress,\n          encodedData: encodedData\n        });\n      }\n    }\n\n    return aggregateCallContext;\n  };\n  /**\r\n   * Find output types from abi\r\n   * @param abi The abi\r\n   * @param methodName The method name\r\n   */\n\n\n  Multicall.prototype.findOutputTypesFromAbi = function (abi, methodName) {\n    for (var i = 0; i < abi.length; i++) {\n      if (abi[i].name === methodName) {\n        return abi[i].outputs;\n      }\n    }\n\n    return undefined;\n  };\n  /**\r\n   * Execute the multicall contract call\r\n   * @param calls The calls\r\n   */\n\n\n  Multicall.prototype.execute = function (calls) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this._executionType;\n\n            switch (_a) {\n              case enums_1.ExecutionType.web3:\n                return [3\n                /*break*/\n                , 1];\n\n              case enums_1.ExecutionType.ethers:\n                return [3\n                /*break*/\n                , 3];\n\n              case enums_1.ExecutionType.customHttp:\n                return [3\n                /*break*/\n                , 3];\n            }\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 1:\n            return [4\n            /*yield*/\n            , this.executeWithWeb3(calls)];\n\n          case 2:\n            return [2\n            /*return*/\n            , _b.sent()];\n\n          case 3:\n            return [4\n            /*yield*/\n            , this.executeWithEthersOrCustom(calls)];\n\n          case 4:\n            return [2\n            /*return*/\n            , _b.sent()];\n\n          case 5:\n            throw new Error(this._executionType + \" is not defined\");\n        }\n      });\n    });\n  };\n  /**\r\n   * Execute aggregate with web3 instance\r\n   * @param calls The calls context\r\n   */\n\n\n  Multicall.prototype.executeWithWeb3 = function (calls) {\n    return __awaiter(this, void 0, void 0, function () {\n      var web3, networkId, contract, contractResponse;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            web3 = this.getTypedOptions().web3Instance;\n            return [4\n            /*yield*/\n            , web3.eth.net.getId()];\n\n          case 1:\n            networkId = _a.sent();\n            contract = web3.eth.Contract(this.ABI, this.getContractBasedOnNetwork(networkId));\n            return [4\n            /*yield*/\n            , contract.methods.aggregate(this.mapCallContextToMatchContractFormat(calls)).call()];\n\n          case 2:\n            contractResponse = _a.sent();\n            return [2\n            /*return*/\n            , this.buildUpAggregateResponse(contractResponse, calls)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Execute with ethers using passed in provider context or custom one\r\n   * @param calls The calls\r\n   */\n\n\n  Multicall.prototype.executeWithEthersOrCustom = function (calls) {\n    return __awaiter(this, void 0, void 0, function () {\n      var ethersProvider, customProvider, network, contract, contractResponse;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ethersProvider = this.getTypedOptions().ethersProvider;\n\n            if (!ethersProvider) {\n              customProvider = this.getTypedOptions();\n\n              if (customProvider.nodeUrl) {\n                ethersProvider = new ethers_1.ethers.providers.JsonRpcProvider(customProvider.nodeUrl);\n              } else {\n                ethersProvider = ethers_1.ethers.getDefaultProvider();\n              }\n            }\n\n            return [4\n            /*yield*/\n            , ethersProvider.getNetwork()];\n\n          case 1:\n            network = _a.sent();\n            contract = new ethers_1.ethers.Contract(this.getContractBasedOnNetwork(network.chainId), this.ABI, ethersProvider);\n            return [4\n            /*yield*/\n            , contract.callStatic.aggregate(this.mapCallContextToMatchContractFormat(calls))];\n\n          case 2:\n            contractResponse = _a.sent();\n            return [2\n            /*return*/\n            , this.buildUpAggregateResponse(contractResponse, calls)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Build up the aggregated response from the contract response mapping\r\n   * metadata from the calls\r\n   * @param contractResponse The contract response\r\n   * @param calls The calls\r\n   */\n\n\n  Multicall.prototype.buildUpAggregateResponse = function (contractResponse, calls) {\n    var aggregateResponse = {\n      blockNumber: contractResponse.blockNumber.toNumber(),\n      results: []\n    };\n\n    var _loop_1 = function (i) {\n      var existingResponse = aggregateResponse.results.find(function (c) {\n        return c.contractContextIndex === calls[i].contractContextIndex;\n      });\n\n      if (existingResponse) {\n        existingResponse.methodResults.push({\n          returnData: contractResponse.returnData[i],\n          contractMethodIndex: calls[i].contractMethodIndex\n        });\n      } else {\n        aggregateResponse.results.push({\n          methodResults: [{\n            returnData: contractResponse.returnData[i],\n            contractMethodIndex: calls[i].contractMethodIndex\n          }],\n          contractContextIndex: calls[i].contractContextIndex\n        });\n      }\n    };\n\n    for (var i = 0; i < contractResponse.returnData.length; i++) {\n      _loop_1(i);\n    }\n\n    return aggregateResponse;\n  };\n  /**\r\n   * Map call contract to match contract format\r\n   * @param calls The calls context\r\n   */\n\n\n  Multicall.prototype.mapCallContextToMatchContractFormat = function (calls) {\n    return calls.map(function (call) {\n      return {\n        target: call.target,\n        callData: call.encodedData\n      };\n    });\n  };\n  /**\r\n   * Get typed options\r\n   */\n\n\n  Multicall.prototype.getTypedOptions = function () {\n    return this._options;\n  };\n  /**\r\n   * Get the contract based on the network\r\n   * @param network The network\r\n   */\n\n\n  Multicall.prototype.getContractBasedOnNetwork = function (network) {\n    // if they have overriden the multicall custom contract address then use that\n    if (this._options.multicallCustomContractAddress) {\n      return this._options.multicallCustomContractAddress;\n    }\n\n    switch (network) {\n      case enums_1.Networks.mainnet:\n        return '0xeefba1e63905ef1d7acba5a8513c70307c1ce441';\n\n      case enums_1.Networks.kovan:\n        return '0x2cc8688c5f75e365aaeeb4ea8d6a480405a48d2a';\n\n      case enums_1.Networks.rinkeby:\n        return '0x42ad527de7d4e9d9d011ac45b31d8551f8fe9821';\n\n      case enums_1.Networks.ropsten:\n        return '0x53c43764255c17bd724f74c4ef150724ac50a3ed';\n\n      default:\n        throw new Error(\"Network - \" + network + \" is not got a contract defined it only supports mainnet, kovan, rinkeby and ropsten\");\n    }\n  };\n\n  return Multicall;\n}();\n\nexports.Multicall = Multicall;","map":{"version":3,"sources":["/Users/hienle/Documents/GitHub/comfortNFT/node_modules/ethereum-multicall/dist/multicall.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","Object","defineProperty","exports","ethers_1","require","utils_1","enums_1","utils_2","Multicall","_options","ABI","constant","inputs","components","name","type","outputs","payable","stateMutability","web3Instance","_executionType","ExecutionType","web3","ethersProvider","ethers","nodeUrl","customHttp","Error","prototype","contractCallContexts","aggregateResponse","returnObject","response","contractCallsResults","originalContractCallContext","returnObjectResult","method","methodContext","originalContractCallMethodContext","outputTypes","decodedReturnValue","_a","Array","isArray","execute","buildAggregateCallContext","results","blockNumber","contractContextIndex","Utils","deepClone","callsReturnContext","methodResults","calls","contractMethodIndex","findOutputTypesFromAbi","abi","methodName","defaultAbiCoder","decode","returnData","returnValues","decoded","reference","methodParameters","aggregateCallContext","contract","contractContext","executingInterface","utils","Interface","JSON","stringify","encodedData","encodeFunctionData","target","contractAddress","i","undefined","_b","executeWithWeb3","executeWithEthersOrCustom","networkId","contractResponse","getTypedOptions","eth","net","getId","Contract","getContractBasedOnNetwork","methods","aggregate","mapCallContextToMatchContractFormat","buildUpAggregateResponse","customProvider","network","providers","JsonRpcProvider","getDefaultProvider","getNetwork","chainId","callStatic","toNumber","_loop_1","existingResponse","find","c","map","callData","multicallCustomContractAddress","Networks","mainnet","kovan","rinkeby","ropsten"],"mappings":"AAAA;;AACA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;AACrF,WAASC,KAAT,CAAeC,KAAf,EAAsB;AAAE,WAAOA,KAAK,YAAYH,CAAjB,GAAqBG,KAArB,GAA6B,IAAIH,CAAJ,CAAM,UAAUI,OAAV,EAAmB;AAAEA,MAAAA,OAAO,CAACD,KAAD,CAAP;AAAiB,KAA5C,CAApC;AAAoF;;AAC5G,SAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAT,CAAN,EAAyB,UAAUD,OAAV,EAAmBE,MAAnB,EAA2B;AACvD,aAASC,SAAT,CAAmBJ,KAAnB,EAA0B;AAAE,UAAI;AAAEK,QAAAA,IAAI,CAACP,SAAS,CAACQ,IAAV,CAAeN,KAAf,CAAD,CAAJ;AAA8B,OAApC,CAAqC,OAAOO,CAAP,EAAU;AAAEJ,QAAAA,MAAM,CAACI,CAAD,CAAN;AAAY;AAAE;;AAC3F,aAASC,QAAT,CAAkBR,KAAlB,EAAyB;AAAE,UAAI;AAAEK,QAAAA,IAAI,CAACP,SAAS,CAAC,OAAD,CAAT,CAAmBE,KAAnB,CAAD,CAAJ;AAAkC,OAAxC,CAAyC,OAAOO,CAAP,EAAU;AAAEJ,QAAAA,MAAM,CAACI,CAAD,CAAN;AAAY;AAAE;;AAC9F,aAASF,IAAT,CAAcI,MAAd,EAAsB;AAAEA,MAAAA,MAAM,CAACC,IAAP,GAAcT,OAAO,CAACQ,MAAM,CAACT,KAAR,CAArB,GAAsCD,KAAK,CAACU,MAAM,CAACT,KAAR,CAAL,CAAoBW,IAApB,CAAyBP,SAAzB,EAAoCI,QAApC,CAAtC;AAAsF;;AAC9GH,IAAAA,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACc,KAAV,CAAgBjB,OAAhB,EAAyBC,UAAU,IAAI,EAAvC,CAAb,EAAyDU,IAAzD,EAAD,CAAJ;AACH,GALM,CAAP;AAMH,CARD;;AASA,IAAIO,WAAW,GAAI,QAAQ,KAAKA,WAAd,IAA8B,UAAUlB,OAAV,EAAmBmB,IAAnB,EAAyB;AACrE,MAAIC,CAAC,GAAG;AAAEC,IAAAA,KAAK,EAAE,CAAT;AAAYC,IAAAA,IAAI,EAAE,YAAW;AAAE,UAAIC,CAAC,CAAC,CAAD,CAAD,GAAO,CAAX,EAAc,MAAMA,CAAC,CAAC,CAAD,CAAP;AAAY,aAAOA,CAAC,CAAC,CAAD,CAAR;AAAc,KAAvE;AAAyEC,IAAAA,IAAI,EAAE,EAA/E;AAAmFC,IAAAA,GAAG,EAAE;AAAxF,GAAR;AAAA,MAAsGC,CAAtG;AAAA,MAAyGC,CAAzG;AAAA,MAA4GJ,CAA5G;AAAA,MAA+GK,CAA/G;AACA,SAAOA,CAAC,GAAG;AAAEjB,IAAAA,IAAI,EAAEkB,IAAI,CAAC,CAAD,CAAZ;AAAiB,aAASA,IAAI,CAAC,CAAD,CAA9B;AAAmC,cAAUA,IAAI,CAAC,CAAD;AAAjD,GAAJ,EAA4D,OAAOC,MAAP,KAAkB,UAAlB,KAAiCF,CAAC,CAACE,MAAM,CAACC,QAAR,CAAD,GAAqB,YAAW;AAAE,WAAO,IAAP;AAAc,GAAjF,CAA5D,EAAgJH,CAAvJ;;AACA,WAASC,IAAT,CAAcG,CAAd,EAAiB;AAAE,WAAO,UAAUC,CAAV,EAAa;AAAE,aAAOvB,IAAI,CAAC,CAACsB,CAAD,EAAIC,CAAJ,CAAD,CAAX;AAAsB,KAA5C;AAA+C;;AAClE,WAASvB,IAAT,CAAcwB,EAAd,EAAkB;AACd,QAAIR,CAAJ,EAAO,MAAM,IAAIS,SAAJ,CAAc,iCAAd,CAAN;;AACP,WAAOf,CAAP,EAAU,IAAI;AACV,UAAIM,CAAC,GAAG,CAAJ,EAAOC,CAAC,KAAKJ,CAAC,GAAGW,EAAE,CAAC,CAAD,CAAF,GAAQ,CAAR,GAAYP,CAAC,CAAC,QAAD,CAAb,GAA0BO,EAAE,CAAC,CAAD,CAAF,GAAQP,CAAC,CAAC,OAAD,CAAD,KAAe,CAACJ,CAAC,GAAGI,CAAC,CAAC,QAAD,CAAN,KAAqBJ,CAAC,CAACa,IAAF,CAAOT,CAAP,CAArB,EAAgC,CAA/C,CAAR,GAA4DA,CAAC,CAAChB,IAAjG,CAAD,IAA2G,CAAC,CAACY,CAAC,GAAGA,CAAC,CAACa,IAAF,CAAOT,CAAP,EAAUO,EAAE,CAAC,CAAD,CAAZ,CAAL,EAAuBnB,IAA9I,EAAoJ,OAAOQ,CAAP;AACpJ,UAAII,CAAC,GAAG,CAAJ,EAAOJ,CAAX,EAAcW,EAAE,GAAG,CAACA,EAAE,CAAC,CAAD,CAAF,GAAQ,CAAT,EAAYX,CAAC,CAAClB,KAAd,CAAL;;AACd,cAAQ6B,EAAE,CAAC,CAAD,CAAV;AACI,aAAK,CAAL;AAAQ,aAAK,CAAL;AAAQX,UAAAA,CAAC,GAAGW,EAAJ;AAAQ;;AACxB,aAAK,CAAL;AAAQd,UAAAA,CAAC,CAACC,KAAF;AAAW,iBAAO;AAAEhB,YAAAA,KAAK,EAAE6B,EAAE,CAAC,CAAD,CAAX;AAAgBnB,YAAAA,IAAI,EAAE;AAAtB,WAAP;;AACnB,aAAK,CAAL;AAAQK,UAAAA,CAAC,CAACC,KAAF;AAAWM,UAAAA,CAAC,GAAGO,EAAE,CAAC,CAAD,CAAN;AAAWA,UAAAA,EAAE,GAAG,CAAC,CAAD,CAAL;AAAU;;AACxC,aAAK,CAAL;AAAQA,UAAAA,EAAE,GAAGd,CAAC,CAACK,GAAF,CAAMY,GAAN,EAAL;;AAAkBjB,UAAAA,CAAC,CAACI,IAAF,CAAOa,GAAP;;AAAc;;AACxC;AACI,cAAI,EAAEd,CAAC,GAAGH,CAAC,CAACI,IAAN,EAAYD,CAAC,GAAGA,CAAC,CAACe,MAAF,GAAW,CAAX,IAAgBf,CAAC,CAACA,CAAC,CAACe,MAAF,GAAW,CAAZ,CAAnC,MAAuDJ,EAAE,CAAC,CAAD,CAAF,KAAU,CAAV,IAAeA,EAAE,CAAC,CAAD,CAAF,KAAU,CAAhF,CAAJ,EAAwF;AAAEd,YAAAA,CAAC,GAAG,CAAJ;AAAO;AAAW;;AAC5G,cAAIc,EAAE,CAAC,CAAD,CAAF,KAAU,CAAV,KAAgB,CAACX,CAAD,IAAOW,EAAE,CAAC,CAAD,CAAF,GAAQX,CAAC,CAAC,CAAD,CAAT,IAAgBW,EAAE,CAAC,CAAD,CAAF,GAAQX,CAAC,CAAC,CAAD,CAAhD,CAAJ,EAA2D;AAAEH,YAAAA,CAAC,CAACC,KAAF,GAAUa,EAAE,CAAC,CAAD,CAAZ;AAAiB;AAAQ;;AACtF,cAAIA,EAAE,CAAC,CAAD,CAAF,KAAU,CAAV,IAAed,CAAC,CAACC,KAAF,GAAUE,CAAC,CAAC,CAAD,CAA9B,EAAmC;AAAEH,YAAAA,CAAC,CAACC,KAAF,GAAUE,CAAC,CAAC,CAAD,CAAX;AAAgBA,YAAAA,CAAC,GAAGW,EAAJ;AAAQ;AAAQ;;AACrE,cAAIX,CAAC,IAAIH,CAAC,CAACC,KAAF,GAAUE,CAAC,CAAC,CAAD,CAApB,EAAyB;AAAEH,YAAAA,CAAC,CAACC,KAAF,GAAUE,CAAC,CAAC,CAAD,CAAX;;AAAgBH,YAAAA,CAAC,CAACK,GAAF,CAAMc,IAAN,CAAWL,EAAX;;AAAgB;AAAQ;;AACnE,cAAIX,CAAC,CAAC,CAAD,CAAL,EAAUH,CAAC,CAACK,GAAF,CAAMY,GAAN;;AACVjB,UAAAA,CAAC,CAACI,IAAF,CAAOa,GAAP;;AAAc;AAXtB;;AAaAH,MAAAA,EAAE,GAAGf,IAAI,CAACiB,IAAL,CAAUpC,OAAV,EAAmBoB,CAAnB,CAAL;AACH,KAjBS,CAiBR,OAAOR,CAAP,EAAU;AAAEsB,MAAAA,EAAE,GAAG,CAAC,CAAD,EAAItB,CAAJ,CAAL;AAAae,MAAAA,CAAC,GAAG,CAAJ;AAAQ,KAjBzB,SAiBkC;AAAED,MAAAA,CAAC,GAAGH,CAAC,GAAG,CAAR;AAAY;;AAC1D,QAAIW,EAAE,CAAC,CAAD,CAAF,GAAQ,CAAZ,EAAe,MAAMA,EAAE,CAAC,CAAD,CAAR;AAAa,WAAO;AAAE7B,MAAAA,KAAK,EAAE6B,EAAE,CAAC,CAAD,CAAF,GAAQA,EAAE,CAAC,CAAD,CAAV,GAAgB,KAAK,CAA9B;AAAiCnB,MAAAA,IAAI,EAAE;AAAvC,KAAP;AAC/B;AACJ,CA1BD;;AA2BAyB,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAErC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIsC,QAAQ,GAAGC,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,kBAAD,CAArB;;AACA,IAAIE,OAAO,GAAGF,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIG,OAAO,GAAGH,OAAO,CAAC,SAAD,CAArB;;AACA,IAAII,SAAS;AAAG;AAAe,YAAY;AACvC,WAASA,SAAT,CAAmBC,QAAnB,EAA6B;AACzB,SAAKA,QAAL,GAAgBA,QAAhB;AACA,SAAKC,GAAL,GAAW,CACP;AACIC,MAAAA,QAAQ,EAAE,KADd;AAEIC,MAAAA,MAAM,EAAE,CACJ;AACIC,QAAAA,UAAU,EAAE,CACR;AAAEC,UAAAA,IAAI,EAAE,QAAR;AAAkBC,UAAAA,IAAI,EAAE;AAAxB,SADQ,EAER;AAAED,UAAAA,IAAI,EAAE,UAAR;AAAoBC,UAAAA,IAAI,EAAE;AAA1B,SAFQ,CADhB;AAKID,QAAAA,IAAI,EAAE,OALV;AAMIC,QAAAA,IAAI,EAAE;AANV,OADI,CAFZ;AAYID,MAAAA,IAAI,EAAE,WAZV;AAaIE,MAAAA,OAAO,EAAE,CACL;AAAEF,QAAAA,IAAI,EAAE,aAAR;AAAuBC,QAAAA,IAAI,EAAE;AAA7B,OADK,EAEL;AAAED,QAAAA,IAAI,EAAE,YAAR;AAAsBC,QAAAA,IAAI,EAAE;AAA5B,OAFK,CAbb;AAiBIE,MAAAA,OAAO,EAAE,KAjBb;AAkBIC,MAAAA,eAAe,EAAE,YAlBrB;AAmBIH,MAAAA,IAAI,EAAE;AAnBV,KADO,CAAX;;AAuBA,QAAI,KAAKN,QAAL,CAAcU,YAAlB,EAAgC;AAC5B,WAAKC,cAAL,GAAsBd,OAAO,CAACe,aAAR,CAAsBC,IAA5C;AACA;AACH;;AACD,QAAI,KAAKb,QAAL,CAAcc,cAAlB,EAAkC;AAC9B,WAAKH,cAAL,GAAsBd,OAAO,CAACe,aAAR,CAAsBG,MAA5C;AACA;AACH;;AACD,QAAI,KAAKf,QAAL,CAAcgB,OAAlB,EAA2B;AACvB,WAAKL,cAAL,GAAsBd,OAAO,CAACe,aAAR,CAAsBK,UAA5C;AACA;AACH;;AACD,UAAM,IAAIC,KAAJ,EACN;AACA,2KAFM,CAAN;AAGH;AACD;AACJ;AACA;AACA;;;AACInB,EAAAA,SAAS,CAACoB,SAAV,CAAoBhC,IAApB,GAA2B,UAAUiC,oBAAV,EAAgC;AACvD,WAAOtE,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,YAAY;AAC/C,UAAIuE,iBAAJ,EAAuBC,YAAvB,EAAqCC,QAArC,EAA+CC,oBAA/C,EAAqEC,2BAArE,EAAkGC,kBAAlG,EAAsHC,MAAtH,EAA8HC,aAA9H,EAA6IC,iCAA7I,EAAgLC,WAAhL,EAA6LC,kBAA7L;AACA,aAAO9D,WAAW,CAAC,IAAD,EAAO,UAAU+D,EAAV,EAAc;AACnC,gBAAQA,EAAE,CAAC5D,KAAX;AACI,eAAK,CAAL;AACI,gBAAI,CAAC6D,KAAK,CAACC,OAAN,CAAcd,oBAAd,CAAL,EAA0C;AACtCA,cAAAA,oBAAoB,GAAG,CAACA,oBAAD,CAAvB;AACH;;AACD,mBAAO,CAAC;AAAE;AAAH,cAAc,KAAKe,OAAL,CAAa,KAAKC,yBAAL,CAA+BhB,oBAA/B,CAAb,CAAd,CAAP;;AACJ,eAAK,CAAL;AACIC,YAAAA,iBAAiB,GAAGW,EAAE,CAAC3D,IAAH,EAApB;AACAiD,YAAAA,YAAY,GAAG;AACXe,cAAAA,OAAO,EAAE,EADE;AAEXC,cAAAA,WAAW,EAAEjB,iBAAiB,CAACiB;AAFpB,aAAf;;AAIA,iBAAKf,QAAQ,GAAG,CAAhB,EAAmBA,QAAQ,GAAGF,iBAAiB,CAACgB,OAAlB,CAA0BhD,MAAxD,EAAgEkC,QAAQ,EAAxE,EAA4E;AACxEC,cAAAA,oBAAoB,GAAGH,iBAAiB,CAACgB,OAAlB,CAA0Bd,QAA1B,CAAvB;AACAE,cAAAA,2BAA2B,GAAGL,oBAAoB,CAACI,oBAAoB,CAACe,oBAAtB,CAAlD;AACAb,cAAAA,kBAAkB,GAAG;AACjBD,gBAAAA,2BAA2B,EAAE3B,OAAO,CAAC0C,KAAR,CAAcC,SAAd,CAAwBhB,2BAAxB,CADZ;AAEjBiB,gBAAAA,kBAAkB,EAAE;AAFH,eAArB;;AAIA,mBAAKf,MAAM,GAAG,CAAd,EAAiBA,MAAM,GAAGH,oBAAoB,CAACmB,aAArB,CAAmCtD,MAA7D,EAAqEsC,MAAM,EAA3E,EAA+E;AAC3EC,gBAAAA,aAAa,GAAGJ,oBAAoB,CAACmB,aAArB,CAAmChB,MAAnC,CAAhB;AACAE,gBAAAA,iCAAiC,GAAGJ,2BAA2B,CAACmB,KAA5B,CAAkChB,aAAa,CAACiB,mBAAhD,CAApC;AACAf,gBAAAA,WAAW,GAAG,KAAKgB,sBAAL,CAA4BrB,2BAA2B,CAACsB,GAAxD,EAA6DlB,iCAAiC,CAACmB,UAA/F,CAAd;;AACA,oBAAIlB,WAAW,IAAIA,WAAW,CAACzC,MAAZ,GAAqB,CAAxC,EAA2C;AACvC0C,kBAAAA,kBAAkB,GAAGnC,OAAO,CAACqD,eAAR,CAAwBC,MAAxB,EACrB;AACApB,kBAAAA,WAFqB,EAERF,aAAa,CAACuB,UAFN,CAArB;AAGAzB,kBAAAA,kBAAkB,CAACgB,kBAAnB,CAAsCpD,IAAtC,CAA2CQ,OAAO,CAAC0C,KAAR,CAAcC,SAAd,CAAwB;AAC/D;AACAW,oBAAAA,YAAY,EAAErB,kBAAkB,CAAC,CAAD,CAF+B;AAG/DsB,oBAAAA,OAAO,EAAE,IAHsD;AAI/DC,oBAAAA,SAAS,EAAEzB,iCAAiC,CAACyB,SAJkB;AAK/DN,oBAAAA,UAAU,EAAEnB,iCAAiC,CAACmB,UALiB;AAM/DO,oBAAAA,gBAAgB,EAAE1B,iCAAiC,CAAC0B;AANW,mBAAxB,CAA3C;AAQH,iBAZD,MAaK;AACD7B,kBAAAA,kBAAkB,CAACgB,kBAAnB,CAAsCpD,IAAtC,CAA2CQ,OAAO,CAAC0C,KAAR,CAAcC,SAAd,CAAwB;AAC/DW,oBAAAA,YAAY,EAAExB,aAAa,CAACuB,UADmC;AAE/DE,oBAAAA,OAAO,EAAE,KAFsD;AAG/DC,oBAAAA,SAAS,EAAEzB,iCAAiC,CAACyB,SAHkB;AAI/DN,oBAAAA,UAAU,EAAEnB,iCAAiC,CAACmB,UAJiB;AAK/DO,oBAAAA,gBAAgB,EAAE1B,iCAAiC,CAAC0B;AALW,mBAAxB,CAA3C;AAOH;AACJ;;AACDjC,cAAAA,YAAY,CAACe,OAAb,CAAqBX,kBAAkB,CAACD,2BAAnB,CAA+C6B,SAApE,IAAiF5B,kBAAjF;AACH;;AACD,mBAAO,CAAC;AAAE;AAAH,cAAeJ,YAAf,CAAP;AAhDR;AAkDH,OAnDiB,CAAlB;AAoDH,KAtDe,CAAhB;AAuDH,GAxDD;AAyDA;AACJ;AACA;AACA;;;AACIvB,EAAAA,SAAS,CAACoB,SAAV,CAAoBiB,yBAApB,GAAgD,UAAUhB,oBAAV,EAAgC;AAC5E,QAAIoC,oBAAoB,GAAG,EAA3B;;AACA,SAAK,IAAIC,QAAQ,GAAG,CAApB,EAAuBA,QAAQ,GAAGrC,oBAAoB,CAAC/B,MAAvD,EAA+DoE,QAAQ,EAAvE,EAA2E;AACvE,UAAIC,eAAe,GAAGtC,oBAAoB,CAACqC,QAAD,CAA1C;AACA,UAAIE,kBAAkB,GAAG,IAAIjE,QAAQ,CAACqB,MAAT,CAAgB6C,KAAhB,CAAsBC,SAA1B,CAAoCC,IAAI,CAACC,SAAL,CAAeL,eAAe,CAACX,GAA/B,CAApC,CAAzB;;AACA,WAAK,IAAIpB,MAAM,GAAG,CAAlB,EAAqBA,MAAM,GAAG+B,eAAe,CAACd,KAAhB,CAAsBvD,MAApD,EAA4DsC,MAAM,EAAlE,EAAsE;AAClE;AACA,YAAIC,aAAa,GAAG8B,eAAe,CAACd,KAAhB,CAAsBjB,MAAtB,CAApB,CAFkE,CAGlE;;AACA,YAAIqC,WAAW,GAAGL,kBAAkB,CAACM,kBAAnB,CAAsCrC,aAAa,CAACoB,UAApD,EAAgEpB,aAAa,CAAC2B,gBAA9E,CAAlB;AACAC,QAAAA,oBAAoB,CAAClE,IAArB,CAA0B;AACtBiD,UAAAA,oBAAoB,EAAEzC,OAAO,CAAC0C,KAAR,CAAcC,SAAd,CAAwBgB,QAAxB,CADA;AAEtBZ,UAAAA,mBAAmB,EAAE/C,OAAO,CAAC0C,KAAR,CAAcC,SAAd,CAAwBd,MAAxB,CAFC;AAGtBuC,UAAAA,MAAM,EAAER,eAAe,CAACS,eAHF;AAItBH,UAAAA,WAAW,EAAEA;AAJS,SAA1B;AAMH;AACJ;;AACD,WAAOR,oBAAP;AACH,GAnBD;AAoBA;AACJ;AACA;AACA;AACA;;;AACIzD,EAAAA,SAAS,CAACoB,SAAV,CAAoB2B,sBAApB,GAA6C,UAAUC,GAAV,EAAeC,UAAf,EAA2B;AACpE,SAAK,IAAIoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrB,GAAG,CAAC1D,MAAxB,EAAgC+E,CAAC,EAAjC,EAAqC;AACjC,UAAIrB,GAAG,CAACqB,CAAD,CAAH,CAAO/D,IAAP,KAAgB2C,UAApB,EAAgC;AAC5B,eAAOD,GAAG,CAACqB,CAAD,CAAH,CAAO7D,OAAd;AACH;AACJ;;AACD,WAAO8D,SAAP;AACH,GAPD;AAQA;AACJ;AACA;AACA;;;AACItE,EAAAA,SAAS,CAACoB,SAAV,CAAoBgB,OAApB,GAA8B,UAAUS,KAAV,EAAiB;AAC3C,WAAO9F,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,YAAY;AAC/C,UAAIkF,EAAJ;;AACA,aAAO/D,WAAW,CAAC,IAAD,EAAO,UAAUqG,EAAV,EAAc;AACnC,gBAAQA,EAAE,CAAClG,KAAX;AACI,eAAK,CAAL;AACI4D,YAAAA,EAAE,GAAG,KAAKrB,cAAV;;AACA,oBAAQqB,EAAR;AACI,mBAAKnC,OAAO,CAACe,aAAR,CAAsBC,IAA3B;AAAiC,uBAAO,CAAC;AAAE;AAAH,kBAAc,CAAd,CAAP;;AACjC,mBAAKhB,OAAO,CAACe,aAAR,CAAsBG,MAA3B;AAAmC,uBAAO,CAAC;AAAE;AAAH,kBAAc,CAAd,CAAP;;AACnC,mBAAKlB,OAAO,CAACe,aAAR,CAAsBK,UAA3B;AAAuC,uBAAO,CAAC;AAAE;AAAH,kBAAc,CAAd,CAAP;AAH3C;;AAKA,mBAAO,CAAC;AAAE;AAAH,cAAc,CAAd,CAAP;;AACJ,eAAK,CAAL;AAAQ,mBAAO,CAAC;AAAE;AAAH,cAAc,KAAKsD,eAAL,CAAqB3B,KAArB,CAAd,CAAP;;AACR,eAAK,CAAL;AAAQ,mBAAO,CAAC;AAAE;AAAH,cAAe0B,EAAE,CAACjG,IAAH,EAAf,CAAP;;AACR,eAAK,CAAL;AAAQ,mBAAO,CAAC;AAAE;AAAH,cAAc,KAAKmG,yBAAL,CAA+B5B,KAA/B,CAAd,CAAP;;AACR,eAAK,CAAL;AAAQ,mBAAO,CAAC;AAAE;AAAH,cAAe0B,EAAE,CAACjG,IAAH,EAAf,CAAP;;AACR,eAAK,CAAL;AAAQ,kBAAM,IAAI6C,KAAJ,CAAU,KAAKP,cAAL,GAAsB,iBAAhC,CAAN;AAbZ;AAeH,OAhBiB,CAAlB;AAiBH,KAnBe,CAAhB;AAoBH,GArBD;AAsBA;AACJ;AACA;AACA;;;AACIZ,EAAAA,SAAS,CAACoB,SAAV,CAAoBoD,eAApB,GAAsC,UAAU3B,KAAV,EAAiB;AACnD,WAAO9F,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,YAAY;AAC/C,UAAI+D,IAAJ,EAAU4D,SAAV,EAAqBhB,QAArB,EAA+BiB,gBAA/B;AACA,aAAOzG,WAAW,CAAC,IAAD,EAAO,UAAU+D,EAAV,EAAc;AACnC,gBAAQA,EAAE,CAAC5D,KAAX;AACI,eAAK,CAAL;AACIyC,YAAAA,IAAI,GAAG,KAAK8D,eAAL,GAAuBjE,YAA9B;AACA,mBAAO,CAAC;AAAE;AAAH,cAAcG,IAAI,CAAC+D,GAAL,CAASC,GAAT,CAAaC,KAAb,EAAd,CAAP;;AACJ,eAAK,CAAL;AACIL,YAAAA,SAAS,GAAGzC,EAAE,CAAC3D,IAAH,EAAZ;AACAoF,YAAAA,QAAQ,GAAG5C,IAAI,CAAC+D,GAAL,CAASG,QAAT,CAAkB,KAAK9E,GAAvB,EAA4B,KAAK+E,yBAAL,CAA+BP,SAA/B,CAA5B,CAAX;AACA,mBAAO,CAAC;AAAE;AAAH,cAAchB,QAAQ,CAACwB,OAAT,CACZC,SADY,CACF,KAAKC,mCAAL,CAAyCvC,KAAzC,CADE,EAEZzD,IAFY,EAAd,CAAP;;AAGJ,eAAK,CAAL;AACIuF,YAAAA,gBAAgB,GAAI1C,EAAE,CAAC3D,IAAH,EAApB;AACA,mBAAO,CAAC;AAAE;AAAH,cAAe,KAAK+G,wBAAL,CAA8BV,gBAA9B,EAAgD9B,KAAhD,CAAf,CAAP;AAZR;AAcH,OAfiB,CAAlB;AAgBH,KAlBe,CAAhB;AAmBH,GApBD;AAqBA;AACJ;AACA;AACA;;;AACI7C,EAAAA,SAAS,CAACoB,SAAV,CAAoBqD,yBAApB,GAAgD,UAAU5B,KAAV,EAAiB;AAC7D,WAAO9F,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,YAAY;AAC/C,UAAIgE,cAAJ,EAAoBuE,cAApB,EAAoCC,OAApC,EAA6C7B,QAA7C,EAAuDiB,gBAAvD;AACA,aAAOzG,WAAW,CAAC,IAAD,EAAO,UAAU+D,EAAV,EAAc;AACnC,gBAAQA,EAAE,CAAC5D,KAAX;AACI,eAAK,CAAL;AACI0C,YAAAA,cAAc,GAAG,KAAK6D,eAAL,GACZ7D,cADL;;AAEA,gBAAI,CAACA,cAAL,EAAqB;AACjBuE,cAAAA,cAAc,GAAG,KAAKV,eAAL,EAAjB;;AACA,kBAAIU,cAAc,CAACrE,OAAnB,EAA4B;AACxBF,gBAAAA,cAAc,GAAG,IAAIpB,QAAQ,CAACqB,MAAT,CAAgBwE,SAAhB,CAA0BC,eAA9B,CAA8CH,cAAc,CAACrE,OAA7D,CAAjB;AACH,eAFD,MAGK;AACDF,gBAAAA,cAAc,GAAGpB,QAAQ,CAACqB,MAAT,CAAgB0E,kBAAhB,EAAjB;AACH;AACJ;;AACD,mBAAO,CAAC;AAAE;AAAH,cAAc3E,cAAc,CAAC4E,UAAf,EAAd,CAAP;;AACJ,eAAK,CAAL;AACIJ,YAAAA,OAAO,GAAGtD,EAAE,CAAC3D,IAAH,EAAV;AACAoF,YAAAA,QAAQ,GAAG,IAAI/D,QAAQ,CAACqB,MAAT,CAAgBgE,QAApB,CAA6B,KAAKC,yBAAL,CAA+BM,OAAO,CAACK,OAAvC,CAA7B,EAA8E,KAAK1F,GAAnF,EAAwFa,cAAxF,CAAX;AACA,mBAAO,CAAC;AAAE;AAAH,cAAc2C,QAAQ,CAACmC,UAAT,CAAoBV,SAApB,CAA8B,KAAKC,mCAAL,CAAyCvC,KAAzC,CAA9B,CAAd,CAAP;;AACJ,eAAK,CAAL;AACI8B,YAAAA,gBAAgB,GAAI1C,EAAE,CAAC3D,IAAH,EAApB;AACA,mBAAO,CAAC;AAAE;AAAH,cAAe,KAAK+G,wBAAL,CAA8BV,gBAA9B,EAAgD9B,KAAhD,CAAf,CAAP;AApBR;AAsBH,OAvBiB,CAAlB;AAwBH,KA1Be,CAAhB;AA2BH,GA5BD;AA6BA;AACJ;AACA;AACA;AACA;AACA;;;AACI7C,EAAAA,SAAS,CAACoB,SAAV,CAAoBiE,wBAApB,GAA+C,UAAUV,gBAAV,EAA4B9B,KAA5B,EAAmC;AAC9E,QAAIvB,iBAAiB,GAAG;AACpBiB,MAAAA,WAAW,EAAEoC,gBAAgB,CAACpC,WAAjB,CAA6BuD,QAA7B,EADO;AAEpBxD,MAAAA,OAAO,EAAE;AAFW,KAAxB;;AAIA,QAAIyD,OAAO,GAAG,UAAU1B,CAAV,EAAa;AACvB,UAAI2B,gBAAgB,GAAG1E,iBAAiB,CAACgB,OAAlB,CAA0B2D,IAA1B,CAA+B,UAAUC,CAAV,EAAa;AAAE,eAAOA,CAAC,CAAC1D,oBAAF,KAA2BK,KAAK,CAACwB,CAAD,CAAL,CAAS7B,oBAA3C;AAAkE,OAAhH,CAAvB;;AACA,UAAIwD,gBAAJ,EAAsB;AAClBA,QAAAA,gBAAgB,CAACpD,aAAjB,CAA+BrD,IAA/B,CAAoC;AAChC6D,UAAAA,UAAU,EAAEuB,gBAAgB,CAACvB,UAAjB,CAA4BiB,CAA5B,CADoB;AAEhCvB,UAAAA,mBAAmB,EAAED,KAAK,CAACwB,CAAD,CAAL,CAASvB;AAFE,SAApC;AAIH,OALD,MAMK;AACDxB,QAAAA,iBAAiB,CAACgB,OAAlB,CAA0B/C,IAA1B,CAA+B;AAC3BqD,UAAAA,aAAa,EAAE,CACX;AACIQ,YAAAA,UAAU,EAAEuB,gBAAgB,CAACvB,UAAjB,CAA4BiB,CAA5B,CADhB;AAEIvB,YAAAA,mBAAmB,EAAED,KAAK,CAACwB,CAAD,CAAL,CAASvB;AAFlC,WADW,CADY;AAO3BN,UAAAA,oBAAoB,EAAEK,KAAK,CAACwB,CAAD,CAAL,CAAS7B;AAPJ,SAA/B;AASH;AACJ,KAnBD;;AAoBA,SAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,gBAAgB,CAACvB,UAAjB,CAA4B9D,MAAhD,EAAwD+E,CAAC,EAAzD,EAA6D;AACzD0B,MAAAA,OAAO,CAAC1B,CAAD,CAAP;AACH;;AACD,WAAO/C,iBAAP;AACH,GA7BD;AA8BA;AACJ;AACA;AACA;;;AACItB,EAAAA,SAAS,CAACoB,SAAV,CAAoBgE,mCAApB,GAA0D,UAAUvC,KAAV,EAAiB;AACvE,WAAOA,KAAK,CAACsD,GAAN,CAAU,UAAU/G,IAAV,EAAgB;AAC7B,aAAO;AACH+E,QAAAA,MAAM,EAAE/E,IAAI,CAAC+E,MADV;AAEHiC,QAAAA,QAAQ,EAAEhH,IAAI,CAAC6E;AAFZ,OAAP;AAIH,KALM,CAAP;AAMH,GAPD;AAQA;AACJ;AACA;;;AACIjE,EAAAA,SAAS,CAACoB,SAAV,CAAoBwD,eAApB,GAAsC,YAAY;AAC9C,WAAO,KAAK3E,QAAZ;AACH,GAFD;AAGA;AACJ;AACA;AACA;;;AACID,EAAAA,SAAS,CAACoB,SAAV,CAAoB6D,yBAApB,GAAgD,UAAUM,OAAV,EAAmB;AAC/D;AACA,QAAI,KAAKtF,QAAL,CAAcoG,8BAAlB,EAAkD;AAC9C,aAAO,KAAKpG,QAAL,CAAcoG,8BAArB;AACH;;AACD,YAAQd,OAAR;AACI,WAAKzF,OAAO,CAACwG,QAAR,CAAiBC,OAAtB;AACI,eAAO,4CAAP;;AACJ,WAAKzG,OAAO,CAACwG,QAAR,CAAiBE,KAAtB;AACI,eAAO,4CAAP;;AACJ,WAAK1G,OAAO,CAACwG,QAAR,CAAiBG,OAAtB;AACI,eAAO,4CAAP;;AACJ,WAAK3G,OAAO,CAACwG,QAAR,CAAiBI,OAAtB;AACI,eAAO,4CAAP;;AACJ;AACI,cAAM,IAAIvF,KAAJ,CAAU,eAAeoE,OAAf,GAAyB,qFAAnC,CAAN;AAVR;AAYH,GAjBD;;AAkBA,SAAOvF,SAAP;AACH,CA7S8B,EAA/B;;AA8SAN,OAAO,CAACM,SAAR,GAAoBA,SAApB","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ethers_1 = require(\"ethers\");\r\nvar utils_1 = require(\"ethers/lib/utils\");\r\nvar enums_1 = require(\"./enums\");\r\nvar utils_2 = require(\"./utils\");\r\nvar Multicall = /** @class */ (function () {\r\n    function Multicall(_options) {\r\n        this._options = _options;\r\n        this.ABI = [\r\n            {\r\n                constant: false,\r\n                inputs: [\r\n                    {\r\n                        components: [\r\n                            { name: 'target', type: 'address' },\r\n                            { name: 'callData', type: 'bytes' },\r\n                        ],\r\n                        name: 'calls',\r\n                        type: 'tuple[]',\r\n                    },\r\n                ],\r\n                name: 'aggregate',\r\n                outputs: [\r\n                    { name: 'blockNumber', type: 'uint256' },\r\n                    { name: 'returnData', type: 'bytes[]' },\r\n                ],\r\n                payable: false,\r\n                stateMutability: 'nonpayable',\r\n                type: 'function',\r\n            },\r\n        ];\r\n        if (this._options.web3Instance) {\r\n            this._executionType = enums_1.ExecutionType.web3;\r\n            return;\r\n        }\r\n        if (this._options.ethersProvider) {\r\n            this._executionType = enums_1.ExecutionType.ethers;\r\n            return;\r\n        }\r\n        if (this._options.nodeUrl) {\r\n            this._executionType = enums_1.ExecutionType.customHttp;\r\n            return;\r\n        }\r\n        throw new Error(\r\n        // tslint:disable-next-line: max-line-length\r\n        'Your options passed in our incorrect they need to match either `MulticallOptionsEthers`, `MulticallOptionsWeb3` or `MulticallOptionsCustomJsonRpcProvider` interfaces');\r\n    }\r\n    /**\r\n     * Call all the contract calls in 1\r\n     * @param calls The calls\r\n     */\r\n    Multicall.prototype.call = function (contractCallContexts) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var aggregateResponse, returnObject, response, contractCallsResults, originalContractCallContext, returnObjectResult, method, methodContext, originalContractCallMethodContext, outputTypes, decodedReturnValue;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!Array.isArray(contractCallContexts)) {\r\n                            contractCallContexts = [contractCallContexts];\r\n                        }\r\n                        return [4 /*yield*/, this.execute(this.buildAggregateCallContext(contractCallContexts))];\r\n                    case 1:\r\n                        aggregateResponse = _a.sent();\r\n                        returnObject = {\r\n                            results: {},\r\n                            blockNumber: aggregateResponse.blockNumber,\r\n                        };\r\n                        for (response = 0; response < aggregateResponse.results.length; response++) {\r\n                            contractCallsResults = aggregateResponse.results[response];\r\n                            originalContractCallContext = contractCallContexts[contractCallsResults.contractContextIndex];\r\n                            returnObjectResult = {\r\n                                originalContractCallContext: utils_2.Utils.deepClone(originalContractCallContext),\r\n                                callsReturnContext: [],\r\n                            };\r\n                            for (method = 0; method < contractCallsResults.methodResults.length; method++) {\r\n                                methodContext = contractCallsResults.methodResults[method];\r\n                                originalContractCallMethodContext = originalContractCallContext.calls[methodContext.contractMethodIndex];\r\n                                outputTypes = this.findOutputTypesFromAbi(originalContractCallContext.abi, originalContractCallMethodContext.methodName);\r\n                                if (outputTypes && outputTypes.length > 0) {\r\n                                    decodedReturnValue = utils_1.defaultAbiCoder.decode(\r\n                                    // tslint:disable-next-line: no-any\r\n                                    outputTypes, methodContext.returnData);\r\n                                    returnObjectResult.callsReturnContext.push(utils_2.Utils.deepClone({\r\n                                        // ethers put the result of the decode in an array\r\n                                        returnValues: decodedReturnValue[0],\r\n                                        decoded: true,\r\n                                        reference: originalContractCallMethodContext.reference,\r\n                                        methodName: originalContractCallMethodContext.methodName,\r\n                                        methodParameters: originalContractCallMethodContext.methodParameters,\r\n                                    }));\r\n                                }\r\n                                else {\r\n                                    returnObjectResult.callsReturnContext.push(utils_2.Utils.deepClone({\r\n                                        returnValues: methodContext.returnData,\r\n                                        decoded: false,\r\n                                        reference: originalContractCallMethodContext.reference,\r\n                                        methodName: originalContractCallMethodContext.methodName,\r\n                                        methodParameters: originalContractCallMethodContext.methodParameters,\r\n                                    }));\r\n                                }\r\n                            }\r\n                            returnObject.results[returnObjectResult.originalContractCallContext.reference] = returnObjectResult;\r\n                        }\r\n                        return [2 /*return*/, returnObject];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Build aggregate call context\r\n     * @param contractCallContexts The contract call contexts\r\n     */\r\n    Multicall.prototype.buildAggregateCallContext = function (contractCallContexts) {\r\n        var aggregateCallContext = [];\r\n        for (var contract = 0; contract < contractCallContexts.length; contract++) {\r\n            var contractContext = contractCallContexts[contract];\r\n            var executingInterface = new ethers_1.ethers.utils.Interface(JSON.stringify(contractContext.abi));\r\n            for (var method = 0; method < contractContext.calls.length; method++) {\r\n                // https://github.com/ethers-io/ethers.js/issues/211\r\n                var methodContext = contractContext.calls[method];\r\n                // tslint:disable-next-line: no-unused-expression\r\n                var encodedData = executingInterface.encodeFunctionData(methodContext.methodName, methodContext.methodParameters);\r\n                aggregateCallContext.push({\r\n                    contractContextIndex: utils_2.Utils.deepClone(contract),\r\n                    contractMethodIndex: utils_2.Utils.deepClone(method),\r\n                    target: contractContext.contractAddress,\r\n                    encodedData: encodedData,\r\n                });\r\n            }\r\n        }\r\n        return aggregateCallContext;\r\n    };\r\n    /**\r\n     * Find output types from abi\r\n     * @param abi The abi\r\n     * @param methodName The method name\r\n     */\r\n    Multicall.prototype.findOutputTypesFromAbi = function (abi, methodName) {\r\n        for (var i = 0; i < abi.length; i++) {\r\n            if (abi[i].name === methodName) {\r\n                return abi[i].outputs;\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    /**\r\n     * Execute the multicall contract call\r\n     * @param calls The calls\r\n     */\r\n    Multicall.prototype.execute = function (calls) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = this._executionType;\r\n                        switch (_a) {\r\n                            case enums_1.ExecutionType.web3: return [3 /*break*/, 1];\r\n                            case enums_1.ExecutionType.ethers: return [3 /*break*/, 3];\r\n                            case enums_1.ExecutionType.customHttp: return [3 /*break*/, 3];\r\n                        }\r\n                        return [3 /*break*/, 5];\r\n                    case 1: return [4 /*yield*/, this.executeWithWeb3(calls)];\r\n                    case 2: return [2 /*return*/, _b.sent()];\r\n                    case 3: return [4 /*yield*/, this.executeWithEthersOrCustom(calls)];\r\n                    case 4: return [2 /*return*/, _b.sent()];\r\n                    case 5: throw new Error(this._executionType + \" is not defined\");\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Execute aggregate with web3 instance\r\n     * @param calls The calls context\r\n     */\r\n    Multicall.prototype.executeWithWeb3 = function (calls) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var web3, networkId, contract, contractResponse;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        web3 = this.getTypedOptions().web3Instance;\r\n                        return [4 /*yield*/, web3.eth.net.getId()];\r\n                    case 1:\r\n                        networkId = _a.sent();\r\n                        contract = web3.eth.Contract(this.ABI, this.getContractBasedOnNetwork(networkId));\r\n                        return [4 /*yield*/, contract.methods\r\n                                .aggregate(this.mapCallContextToMatchContractFormat(calls))\r\n                                .call()];\r\n                    case 2:\r\n                        contractResponse = (_a.sent());\r\n                        return [2 /*return*/, this.buildUpAggregateResponse(contractResponse, calls)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Execute with ethers using passed in provider context or custom one\r\n     * @param calls The calls\r\n     */\r\n    Multicall.prototype.executeWithEthersOrCustom = function (calls) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var ethersProvider, customProvider, network, contract, contractResponse;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        ethersProvider = this.getTypedOptions()\r\n                            .ethersProvider;\r\n                        if (!ethersProvider) {\r\n                            customProvider = this.getTypedOptions();\r\n                            if (customProvider.nodeUrl) {\r\n                                ethersProvider = new ethers_1.ethers.providers.JsonRpcProvider(customProvider.nodeUrl);\r\n                            }\r\n                            else {\r\n                                ethersProvider = ethers_1.ethers.getDefaultProvider();\r\n                            }\r\n                        }\r\n                        return [4 /*yield*/, ethersProvider.getNetwork()];\r\n                    case 1:\r\n                        network = _a.sent();\r\n                        contract = new ethers_1.ethers.Contract(this.getContractBasedOnNetwork(network.chainId), this.ABI, ethersProvider);\r\n                        return [4 /*yield*/, contract.callStatic.aggregate(this.mapCallContextToMatchContractFormat(calls))];\r\n                    case 2:\r\n                        contractResponse = (_a.sent());\r\n                        return [2 /*return*/, this.buildUpAggregateResponse(contractResponse, calls)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Build up the aggregated response from the contract response mapping\r\n     * metadata from the calls\r\n     * @param contractResponse The contract response\r\n     * @param calls The calls\r\n     */\r\n    Multicall.prototype.buildUpAggregateResponse = function (contractResponse, calls) {\r\n        var aggregateResponse = {\r\n            blockNumber: contractResponse.blockNumber.toNumber(),\r\n            results: [],\r\n        };\r\n        var _loop_1 = function (i) {\r\n            var existingResponse = aggregateResponse.results.find(function (c) { return c.contractContextIndex === calls[i].contractContextIndex; });\r\n            if (existingResponse) {\r\n                existingResponse.methodResults.push({\r\n                    returnData: contractResponse.returnData[i],\r\n                    contractMethodIndex: calls[i].contractMethodIndex,\r\n                });\r\n            }\r\n            else {\r\n                aggregateResponse.results.push({\r\n                    methodResults: [\r\n                        {\r\n                            returnData: contractResponse.returnData[i],\r\n                            contractMethodIndex: calls[i].contractMethodIndex,\r\n                        },\r\n                    ],\r\n                    contractContextIndex: calls[i].contractContextIndex,\r\n                });\r\n            }\r\n        };\r\n        for (var i = 0; i < contractResponse.returnData.length; i++) {\r\n            _loop_1(i);\r\n        }\r\n        return aggregateResponse;\r\n    };\r\n    /**\r\n     * Map call contract to match contract format\r\n     * @param calls The calls context\r\n     */\r\n    Multicall.prototype.mapCallContextToMatchContractFormat = function (calls) {\r\n        return calls.map(function (call) {\r\n            return {\r\n                target: call.target,\r\n                callData: call.encodedData,\r\n            };\r\n        });\r\n    };\r\n    /**\r\n     * Get typed options\r\n     */\r\n    Multicall.prototype.getTypedOptions = function () {\r\n        return this._options;\r\n    };\r\n    /**\r\n     * Get the contract based on the network\r\n     * @param network The network\r\n     */\r\n    Multicall.prototype.getContractBasedOnNetwork = function (network) {\r\n        // if they have overriden the multicall custom contract address then use that\r\n        if (this._options.multicallCustomContractAddress) {\r\n            return this._options.multicallCustomContractAddress;\r\n        }\r\n        switch (network) {\r\n            case enums_1.Networks.mainnet:\r\n                return '0xeefba1e63905ef1d7acba5a8513c70307c1ce441';\r\n            case enums_1.Networks.kovan:\r\n                return '0x2cc8688c5f75e365aaeeb4ea8d6a480405a48d2a';\r\n            case enums_1.Networks.rinkeby:\r\n                return '0x42ad527de7d4e9d9d011ac45b31d8551f8fe9821';\r\n            case enums_1.Networks.ropsten:\r\n                return '0x53c43764255c17bd724f74c4ef150724ac50a3ed';\r\n            default:\r\n                throw new Error(\"Network - \" + network + \" is not got a contract defined it only supports mainnet, kovan, rinkeby and ropsten\");\r\n        }\r\n    };\r\n    return Multicall;\r\n}());\r\nexports.Multicall = Multicall;\r\n"]},"metadata":{},"sourceType":"script"}